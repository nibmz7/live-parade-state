rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
  
    match /branches/{adminid}/repository/{uid} {
    
    	function getAdmins() {
      	return ["admin@sbw.plc", "admin@test.com"];
      }
    
    	function isAdmin() {
    		return request.auth.token.email in getAdmins()
        && request.auth.uid == adminid;
    	}
      
      function isSameBranch() {
        return request.auth.token.branchid == adminid;
      }

      allow update: if isSameBranch() || isAdmin() 
                    && request.resource.data.diff(resource.data).changedKeys().hasOnly(["status"]);
          
      allow read: if isSameBranch() || isAdmin();

    }  
  }
}